<!DOCTYPE html>
<html>
<head>
    <title>Liberty NFT Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Liberty NFT Viewer</h1>
    <label for="walletAddress">Enter Wallet Address:</label>
    <input type="text" id="walletAddress" placeholder="0xYourWalletAddress" />
    <button onclick="fetchNFTs()">Find My NFTs</button>
    
    <div id="nft-list"></div>
    
    <script>
        const provider = new ethers.providers.JsonRpcProvider("https://rpc.libertyproject.space/");
        const contractAddress = "0x691ea6B18cbaffB0341908b55A1431C06702F1EB"; // Replace with actual deployed contract
        const contractABI = [
            {
                "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }],
                "name": "balanceOf",
                "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{ "internalType": "uint256", "name": "tokenId", "type": "uint256" }],
                "name": "ownerOf",
                "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{ "internalType": "uint256", "name": "tokenId", "type": "uint256" }],
                "name": "tokenURI",
                "outputs": [{ "internalType": "string", "name": "", "type": "string" }],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        async function fetchNFTs() {
            const walletAddress = document.getElementById("walletAddress").value.trim();
            if (!ethers.utils.isAddress(walletAddress)) {
                alert("Invalid wallet address!");
                return;
            }
            
            const contract = new ethers.Contract(contractAddress, contractABI, provider);
            document.getElementById("nft-list").innerHTML = "<p>Searching for NFTs...</p>";
            let nftListHTML = "";
            
            for (let tokenId = 1; tokenId <= 100; tokenId++) { // Searches Token IDs from 1-100
                try {
                    const owner = await contract.ownerOf(tokenId);
                    if (owner.toLowerCase() === walletAddress.toLowerCase()) {
                        const tokenURI = await contract.tokenURI(tokenId);
                        const metadataUrl = tokenURI.replace("ipfs://", "https://red-secret-guanaco-45.mypinata.cloud/ipfs/");
                        const metadata = await fetch(metadataUrl).then(res => res.json());

                        nftListHTML += `<div>
                            <h3>${metadata.name} (Token ID: ${tokenId})</h3>
                            <p>${metadata.description}</p>
                            <img src="${metadata.image.replace("ipfs://", "https://red-secret-guanaco-45.mypinata.cloud/ipfs/")}" width="200px" />
                        </div>`;
                    }
                } catch (error) {
                    console.log(`Token ID ${tokenId} does not exist or error fetching.`);
                }
            }
            
            document.getElementById("nft-list").innerHTML = nftListHTML || "<p>No NFTs found for this address.</p>";
        }
    </script>
</body>
</html>
