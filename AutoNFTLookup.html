<!DOCTYPE html>
<html>
<head>
    <title>Liberty NFT Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Liberty NFT Viewer 2.0</h1>
    
    <label for="walletAddress">Enter Wallet Address:</label>
    <input type="text" id="walletAddress" placeholder="0xYourWalletAddress" />
    
    <label for="tokenId">Enter Token ID:</label>
    <input type="number" id="tokenId" placeholder="1" />
    
    <button onclick="fetchNFT()">Find My NFT</button>
    
    <div id="nft-display"></div>

    <script>
        const provider = new ethers.providers.JsonRpcProvider("https://rpc.libertyproject.space/");
        const contractAddress = "0x691ea6B18cbaffB0341908b55A1431C06702F1EB"; // Replace with your contract address
        const contractABI = [
            {
                "inputs": [{ "internalType": "uint256", "name": "tokenId", "type": "uint256" }],
                "name": "ownerOf",
                "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{ "internalType": "uint256", "name": "tokenId", "type": "uint256" }],
                "name": "tokenURI",
                "outputs": [{ "internalType": "string", "name": "", "type": "string" }],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        function getURLParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                wallet: params.get("wallet"),
                tokenId: params.get("tokenId")
            };
        }

        async function fetchNFT() {
            const wallet = document.getElementById("walletAddress").value.trim();
            const tokenId = document.getElementById("tokenId").value.trim();

            if (!ethers.utils.isAddress(wallet)) {
                alert("Invalid wallet address!");
                return;
            }

            const contract = new ethers.Contract(contractAddress, contractABI, provider);

            try {
                const owner = await contract.ownerOf(tokenId);
                if (owner.toLowerCase() !== wallet.toLowerCase()) {
                    alert("This wallet does not own the specified Token ID.");
                    return;
                }

                const tokenURI = await contract.tokenURI(tokenId);
                const metadataUrl = tokenURI.replace("ipfs://", "https://red-secret-guanaco-45.mypinata.cloud/ipfs/");
                const metadata = await fetch(metadataUrl).then(res => res.json());

                let imagesHTML = "";
                if (Array.isArray(metadata.images)) {
                    metadata.images.forEach(image => {
                        imagesHTML += `<img src="${image.replace("ipfs://", "https://red-secret-guanaco-45.mypinata.cloud/ipfs/")}" width="200px" />`;
                    });
                } else {
                    imagesHTML = `<img src="${metadata.image.replace("ipfs://", "https://red-secret-guanaco-45.mypinata.cloud/ipfs/")}" width="200px" />`;
                }

                document.getElementById("nft-display").innerHTML = `
                    <h3>${metadata.name} (Token ID: ${tokenId})</h3>
                    <p>${metadata.description}</p>
                    ${imagesHTML}
                    <p>Owned by: ${owner}</p>
                `;
            } catch (error) {
                alert("Error fetching NFT details. Please check the Token ID.");
                console.log(error);
            }
        }

        window.onload = () => {
            const params = getURLParams();
            if (params.wallet && params.tokenId) {
                document.getElementById("walletAddress").value = params.wallet;
                document.getElementById("tokenId").value = params.tokenId;
                fetchNFT();
            }
        };
    </script>
</body>
</html>
